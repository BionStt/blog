var blogStoryManager={tags:[],publishText:"Published",initialize:function(e){this.tags=e,this.initializeShortCuts(),tinyMCE.baseURL="https://cdn.jsdelivr.net/npm/tinymce@4.7.13/",tinymce.init({selector:".editor",height:500,menubar:!0,branding:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste codesample"],toolbar:"undo redo | insert | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | codesample",codesample_languages:[{text:"HTML/XML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"CSS",value:"css"},{text:"C",value:"c"},{text:"C#",value:"csharp"},{text:"ASP.NET MVC",value:"aspnet"},{text:"Bash",value:"bash"},{text:"Powershell",value:"powershell"},{text:"DockerFile",value:"docker"},{text:"Yaml",value:"yaml"}],setup:function(e){e.shortcuts.add("ctrl+s","save story",function(){$("#edit-story").submit()}),e.on("FullscreenStateChanged",function(e){e.state?window.location.hash="fullscreen":window.location.hash=""}),e.on("init",function(){"#fullscreen"===window.location.hash&&tinyMCE.execCommand("mceFullScreen")})}}),this.initializeTagsSelector(),this.initializeActions()},initializeTagsSelector:function(){$(".tag-editor").length&&(this.tagsSelectize=$(".tag-editor").selectize({plugins:["remove_button"],delimiter:",",maxItems:3,valueField:"id",labelField:"name",searchField:"name",options:this.tags,create:function(e,i){var t=JSON.stringify({name:e});$.ajax({type:"POST",url:"/author/tags",data:t,contentType:"application/json",success:function(e){var t={id:e.id,name:e.name};i(t),blogStoryManager.tags.push(t)},error:function(e){alert(e)}})}}))},initializeActions:function(){$("#publish-btn").click(function(){var e=$(this),t=$("#Id").val(),i=e.attr("set");$.ajax({type:"PATCH",url:"/author/stories/"+t+"?isPublished="+i,contentType:"application/json",success:function(e){e&&(e.redirect?location.replace(e.redirect):location.reload())},error:function(e){alert(e)}})}),$("#share-link-copy").click(blogStoryManager.copyShareLink),$("form").prop("action",function(e,t){return t+window.location.hash})},initializeShortCuts:function(){$(window).bind("keydown",function(e){if(e.ctrlKey||e.metaKey)switch(String.fromCharCode(e.which).toLowerCase()){case"s":e.preventDefault(),$("#edit-story").submit()}})},initializeCopyShareLinkEvent:function(){var i=function(e){var t=$("#share-link-copy").attr("link");e.clipboardData.setData("text/plain",t),document.removeEventListener("copy",i),e.preventDefault()};document.addEventListener("copy",i)},copyShareLink:function(e){var t=$("#story-status span").text().trim()===blogStoryManager.publishText;if(blogStoryManager.initializeCopyShareLinkEvent(),t){var i=$("#share-link").attr("href");$("#share-link-copy").attr("link",location.origin+i),document.execCommand("copy")}else if($("#share-link-copy").attr("link"))document.execCommand("copy");else if($("#AccessToken").val()){var a=$("#Alias").val(),n=$("#AccessToken").val();$("#share-link-copy").attr("link",location.origin+"/drafts/"+a+"?token="+n),document.execCommand("copy")}else blogStoryManager.createShareLink()},createShareLink:function(){var e=$("#Id").val();$.ajax({type:"POST",url:"/author/stories/"+e+"/sharelinks",success:function(e){$("#share-link-copy").attr("link",location.origin+e.link),document.execCommand("copy")},error:function(e){alert(e)}})}};